<!DOCTYPE html>
<html lang="en" >
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>HTML5仿电脑端微信聊天窗口界面代码</title>
	<link rel="stylesheet" href="http://test.mystaticdomain.com/mychat/css/reset.min.css">
	<link rel="stylesheet" href="http://test.mystaticdomain.com/mychat/css/style.css">
	<script src="http://test.mystaticdomain.com/js/jquery.min.js?v=2.1.4"></script>
	<script src="http://test.mystaticdomain.com/js/socket.io.min.1.7.4.js"></script>
</head>
<body>

<div class="wrapper">
	<div class="container">
        <div class="left">
            <div class="top">
                <input type="text" placeholder="Search" />
                <a href="javascript:;" class="search"></a>
            </div>
            <ul class="people">
                <li class="person" person-chat="person1">
                    <img src="http://test.mystaticdomain.com/mychat/img/thomas.jpg" alt="" />
                    <span class="name">Thomas Bangalter</span>
                    <span class="time">2:09 PM</span>
                    <span class="preview">I was wondering...</span>
                </li>
                <li class="person" person-chat="person2">
                    <img src="http://test.mystaticdomain.com/mychat/img/dog.png" alt="" />
                    <span class="name">Dog Woofson</span>
                    <span class="time">1:44 PM</span>
                    <span class="preview">I've forgotten how it felt before</span>
                </li>
                <li class="person" person-chat="person3">
                    <img src="http://test.mystaticdomain.com/mychat/img/louis-ck.jpeg" alt="" />
                    <span class="name">Louis CK</span>
                    <span class="time">2:09 PM</span>
                    <span class="preview">But we’re probably gonna need a new carpet.</span>
                </li>
                <li class="person" person-chat="person4">
                    <img src="http://test.mystaticdomain.com/mychat/img/bo-jackson.jpg" alt="" />
                    <span class="name">Bo Jackson</span>
                    <span class="time">2:09 PM</span>
                    <span class="preview">It’s not that bad...</span>
                </li>
                <li class="person" person-chat="person5">
                    <img src="http://test.mystaticdomain.com/mychat/img/michael-jordan.jpg" alt="" />
                    <span class="name">Michael Jordan</span>
                    <span class="time">2:09 PM</span>
                    <span class="preview">Wasup for the third time like is 
you blind bitch</span>
                </li>
                <li class="person" person-chat="person6">
                    <img src="http://test.mystaticdomain.com/mychat/img/drake.jpg" alt="" />
                    <span class="name">Drake</span>
                    <span class="time">2:09 PM</span>
                    <span class="preview">howdoyoudoaspace</span>
                </li>
            </ul>
        </div>
        <div class="right">
            <div class="top"><span>To: <span class="name">Dog Woofson</span></span></div>
            <div class="chat" data-chat="person1">
                <div class="conversation-start">
                    <span>Today, 6:48 AM</span>
                </div>
                <div class="bubble you">
                    Hello,
                </div>
                <div class="bubble you">
                    it's me.
                </div>
                <div class="bubble you">
                    I was wondering...
                </div>
            </div>
            <div class="chat" data-chat="person2">
                <div class="conversation-start">
                    <span>Today, 5:38 PM</span>
                </div>
                <div class="bubble you">
                    Hello, can you hear me?
                </div>
                <div class="bubble you">
                    I'm in California dreaming
                </div>
                <div class="bubble me">
                    ... about who we used to be.
                </div>
                <div class="bubble me">
                    Are you serious?
                </div>
                <div class="bubble you">
                    When we were younger and free...
                </div>
                <div class="bubble you">
                    I've forgotten how it felt before
                </div>
            </div>
            <div class="chat" data-chat="person3">
                <div class="conversation-start">
                    <span>Today, 3:38 AM</span>
                </div>
                <div class="bubble you">
                    Hey human!
                </div>
                <div class="bubble you">
                    Umm... Someone took a shit in the hallway.
                </div>
                <div class="bubble me">
                    ... what.
                </div>
                <div class="bubble me">
                    Are you serious?
                </div>
                <div class="bubble you">
                    I mean...
                </div>
                <div class="bubble you">
                    It’s not that bad...
                </div>
                <div class="bubble you">
                    But we’re probably gonna need a new carpet.
                </div>
            </div>
            <div class="chat" data-chat="person4">
                <div class="conversation-start">
                    <span>Yesterday, 4:20 PM</span>
                </div>
                <div class="bubble me">
                    Hey human!
                </div>
                <div class="bubble me">
                    Umm... Someone took a shit in the hallway.
                </div>
                <div class="bubble you">
                    ... what.
                </div>
                <div class="bubble you">
                    Are you serious?
                </div>
                <div class="bubble me">
                    I mean...
                </div>
                <div class="bubble me">
                    It’s not that bad...
                </div>
            </div>
            <div class="chat" data-chat="person5">
                <div class="conversation-start">
                    <span>Today, 6:28 AM</span>
                </div>
                <div class="bubble you">
                    Wasup
                </div>
                <div class="bubble you">
                    Wasup
                </div>
                <div class="bubble you">
                    Wasup for the third time like is <br />you blind bitch
                </div>

            </div>
            <div class="chat" data-chat="person6">
                <div class="conversation-start">
                    <span>Monday, 1:27 PM</span>
                </div>
                <div class="bubble you">
                    So, how's your new phone?
                </div>
                <div class="bubble you">
                    You finally have a smartphone :D
                </div>
                <div class="bubble me">
                    Drake?
                </div>
                <div class="bubble me">
                    Why aren't you answering?
                </div>
                <div class="bubble you">
                    howdoyoudoaspace
                </div>
            </div>
            <div class="write">
                <a href="javascript:;" class="write-link attach"></a>
                <input id="msg" type="text" placeholder="在这里说点儿什么   ...." onkeydown="keyup_submit(event);"/>
                <a href="javascript:;" class="write-link smiley"></a>
                <a href="javascript:;" class="write-link send"></a>
            </div>
        </div>
    </div>
</div>



<div style="text-align:center;margin:1px 0; font:normal 14px/24px 'MicroSoft YaHei';">
<p>适用浏览器：360、FireFox、Chrome、Opera、傲游、搜狗、世界之窗. 不支持Safari、IE8及以下浏览器。</p>
<p>来源：<a href="http://www.lanrenzhijia.com/" target="_blank">懒人</a></p>
</div>
<input id="username" class="input-xlarge" type="hidden" placeholder="用户名称. . . " />
<input id="userid" class="input-xlarge" type="hidden" placeholder="用户id. . . " />
<script type="text/javascript">
document.querySelector('.chat[data-chat=person2]').classList.add('active-chat');
document.querySelector('.person[person-chat=person2]').classList.add('active');
var msg='';
var friends = {
  list: document.querySelector('ul.people'),
  all: document.querySelectorAll('.left .person'),
  name: '' },

chat = {
  container: document.querySelector('.container .right'),//所有聊天放到container里边
  current: null,
  person: null,
  name: document.querySelector('.container .right .top .name') };//把聊天栏上面的属性付给"chat数组"中的name.


friends.all.forEach(function (f) {
  f.addEventListener('mousedown', function () {

    f.classList.contains('active') || setAciveChat(f);
  });
});

function setAciveChat(f) {
  friends.list.querySelector('.active').classList.remove('active');//移除之前选中的朋友的光标
  f.classList.add('active');//添加选中朋友光标
  chat.current = chat.container.querySelector('.active-chat');//把之前的聊天信息放到当前里边
  chat.person = f.getAttribute('person-chat');//把当前人放到数组
  chat.current.classList.remove('active-chat');//移除之前选中的朋友的聊天光标
  chat.container.querySelector('[data-chat="' + chat.person + '"]').classList.add('active-chat');//添加选中的朋友的聊天记录的光标
  friends.name = f.querySelector('.name').innerText;//把选中的朋友的名字放到 friends数组里。
  chat.name.innerHTML = friends.name;//把选中的朋友的名字放到右侧top处的名字上。
  $('[data-chat="' + chat.person + '"]').scrollTop($('[data-chat="' + chat.person + '"]')[0].scrollHeight);
 // $('[data-chat="' + chat.person + '"]').append(element);
}
var socket;
connect();
var receiver = '刘兴';
function connect() {
	var sender ='雨晨';
    var opts = {
        query: 'sender=' + sender
    };
    socket = io.connect('http://test.huayubenji.com:9099', opts);
	
    $("#username").val(sender);
    $("#userid").val(sender);
    socket.on('connect', function () {
        
        isOnline('上线');
    });

    socket.on('push_event', function (data) {
    	showReceivedMessage(data.content);
    });

    socket.on('disconnect', function () {
    	isOnline('离线');
    });
}
function isOnline(message) {
	//alert('网络良好，已经在线');
}

/**对话框回车事件*/
function keyup_submit(e){
	msg = $("#msg").val();
    var evt = window.event || e;
    if (evt.keyCode == 13){
        sendMess();
    }
}

function sendMess(){
	if(msg==''){
		return;
	}
    socket.emit('push_event', {
        sender: $("#userid").val(),
        nickName: $("#username").val(),
        receiver: receiver,
        content: msg
    },function (answer) {
    	if(answer===1){
    		showSendedMessage(msg);
    	}else{
    		showSendedMessage(msg+'<font color="red">(发送失败)</font>');
    	}
    	$("#msg").val("");
    });
	
	
}

function showSendedMessage(msg) {
    var element = $('<div class="bubble me">' + ' ' + msg + '</div>');
    $('[data-chat="' + chat.person + '"]').append(element);
	$('[data-chat="' + chat.person + '"]').scrollTop($('[data-chat="' + chat.person + '"]')[0].scrollHeight);
}
function showReceivedMessage(msg) {
    var element = $('<div class="bubble you">' + ' ' + msg + '</div>');
    $('[data-chat="' + chat.person + '"]').append(element);
	$('[data-chat="' + chat.person + '"]').scrollTop($('[data-chat="' + chat.person + '"]')[0].scrollHeight);
}
</script>
</body>
</html>